{"code":"!function(t){var e={};function a(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=e,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)a.d(i,r,function(e){return t[e]}.bind(null,r));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,\"a\",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p=\"\",a(a.s=0)}([function(t,e,a){\"use strict\";let i;a.r(e);let r=new Map,n=new Map;a.d(e,\"default\",function(){return H});let s=document.getElementById(\"game\"),o=s.getContext(\"2d\"),h=new class{constructor(){if(i)return i;i=this,this.pool=new Pool,this.reset(),this.prepared=0,this.aiOver=!0,this.playerOver=!0,this.initAIState(),this.randomAITarget(),this.initPlayerState(),this.randomPlayerTarget(),this.initPolicy(),this.initTransition()}initAIState(){this.aiState<0&&(this.aiState=parseInt(100*Math.random()),this.aiLastState=this.aiState)}initPlayerState(){this.playerState<0&&(this.playerState=parseInt(100*Math.random()),this.playerLastState=this.playerState)}initPolicy(){var t=this;axios.get(\"https://eater.liwanyi.me/policy\").then(function(e){for(var a in e.data){var i=e.data[a],n=new Map;for(var s in i)n.set(parseInt(s),parseInt(i[s]));r.set(parseInt(a),n)}t.prepared+=1}).catch(function(t){console.log(t)})}initTransition(){var t=this;axios.get(\"https://eater.liwanyi.me/transition\").then(function(e){for(var a in e.data){var i=e.data[a];n.set(parseInt(a),i)}t.prepared+=1}).catch(function(t){console.log(t)})}isPrepared(){return this.prepared>=2}reset(){this.frame=0,this.aiState=-1,this.aiLastState=-1,this.aiAction=-1,this.aiTarget=-1,this.playerState=-1,this.playerLastState=-1,this.playerAction=-1,this.playerTarget=-1,this.playerLastAction=this.playerAction,this.playerLastTouchTime=0,this.playerShouldStop=!1,this.playerPoint=0,this.aiPoint=0,this.gameOver=!1,this.rate=.5,this.lastRate=0}getPlayerPoint(){return this.playerPoint>9?this.playerPoint:\"0\"+this.playerPoint}getAIPoint(){return this.aiPoint>9?this.aiPoint:\"0\"+this.aiPoint}randomAITarget(){for(this.aiLastTarget=this.aiTarget;;){var t=parseInt(100*Math.random());if(t!=this.playerTarget&&t!=this.aiState&&t!=this.playerState){this.aiTarget=t;break}}}getPointRate(){return this.rate}calculateRate(){if(this.aiPoint>this.playerPoint){var t=this.aiPoint-this.playerPoint;this.rate=(50+t)/100}else this.aiPoint<this.playerPoint&&(t=this.playerPoint-this.aiPoint,this.rate=(50-t)/100)}shouldDrawPoint(){return this.lastRate!=this.rate}resetLastRate(){this.lastRate=this.rate}checkGameOver(){return(this.aiPoint>=50||this.playerPoint>=50)&&(this.gameOver=!0),this.gameOver=!1,this.gameOver}randomPlayerTarget(){for(this.playerLastTarget=this.playerTarget;;){var t=parseInt(100*Math.random());if(t!=this.aiTarget&&t!=this.playerState&&t!=this.aiState){this.playerTarget=t;break}}}nextAIState(){return this.aiAction=this.getAction(this.aiState,this.aiTarget),this.aiLastState=this.aiState,this.aiState=this.getState(this.aiState,this.aiAction),this.aiState}nextPlayerState(){return-1==this.playerAction?this.playerState:(this.playerLastState=this.playerState,this.playerState=this.getState(this.playerState,this.playerAction),this.playerState)}setPlayerAction(t){this.playerLastAction=this.playerAction,this.playerAction=t}isAIOver(){return this.aiOver=this.aiState==this.aiTarget,this.aiOver&&(this.aiPoint+=1,this.calculateRate()),this.aiOver}isPlayerOver(){return this.playerOver=this.playerState==this.playerTarget,this.playerOver&&(this.playerPoint+=1,this.calculateRate()),this.playerOver}getAction(t,e){return r.get(e).get(t)}getState(t,e){return n.get(t)[e]}},l=24,d=4,c=l+d,p=10*l+11*d,g=parseInt(window.innerHeight/4),y=(window.innerWidth-p)/2,u=20,m=5;var w=document.createCanvas(),v=w.getContext(\"2d\"),f=document.createCanvas(),I=f.getContext(\"2d\"),S=parseInt(window.innerWidth/3),T=parseInt(window.innerHeight/24),P=S,L=parseInt(window.innerHeight/6),_=document.createCanvas(),A=_.getContext(\"2d\"),b=document.getElementById(\"img_bean_ai\"),O=document.getElementById(\"img_bean_player\"),E=document.getElementById(\"img_eater_ai_up\"),R=document.getElementById(\"img_eater_ai_right\"),B=document.getElementById(\"img_eater_ai_down\"),x=document.getElementById(\"img_eater_ai_left\"),M=document.getElementById(\"img_eater_player_up\"),k=document.getElementById(\"img_eater_player_right\"),C=document.getElementById(\"img_eater_player_down\"),D=document.getElementById(\"img_eater_player_left\");class H{constructor(){this.aniId=0,this.initImage(),this.initTouchEvent(),this.initLabyrinth(),this.restart()}restart(){s.removeEventListener(\"touchstart\",this.touchHandler),this.bindLoop=this.loop.bind(this),window.cancelAnimationFrame(this.aniId),this.aniId=window.requestAnimationFrame(this.bindLoop,s)}initTouchEvent(){s.addEventListener(\"touchstart\",t=>{if(t.preventDefault(),0==h.playerLastTouchTime)h.playerLastTouchTime=(new Date).getTime();else{var e=(new Date).getTime();e-h.playerLastTouchTime<=250&&(h.playerShouldStop=!0),h.playerLastTouchTime=e}h.playerTouchStartX=t.touches[0].clientX,h.playerTouchStartY=t.touches[0].clientY}),s.addEventListener(\"touchmove\",t=>{t.preventDefault();var e=t.touches[0].clientX,a=t.touches[0].clientY-h.playerTouchStartY,i=e-h.playerTouchStartX;Math.abs(i)<50&&Math.abs(a)<50||(Math.abs(a)>Math.abs(i)?a>0?h.setPlayerAction(2):h.setPlayerAction(0):i>0?h.setPlayerAction(1):h.setPlayerAction(3))}),s.addEventListener(\"touchend\",t=>{t.preventDefault(),h.playerShouldStop&&(h.setPlayerAction(-1),h.playerShouldStop=!1)})}initImage(){b.src=\"images/bean_ai.png\",b.onload=function(){},O.src=\"images/bean_player.png\",O.onload=function(){},E.src=\"images/eater_ai_up.png\",E.onload=function(){},R.src=\"images/eater_ai_right.png\",R.onload=function(){},B.src=\"images/eater_ai_down.png\",B.onload=function(){},x.src=\"images/eater_ai_left.png\",x.onload=function(){},M.src=\"images/eater_player_up.png\",M.onload=function(){},k.src=\"images/eater_player_right.png\",k.onload=function(){},C.src=\"images/eater_player_down.png\",C.onload=function(){},D.src=\"images/eater_player_left.png\",D.onload=function(){}}initLabyrinth(){o.lineWidth=d/2,this.setBackground(),this.drawBorder(),this.drawLabyrinth()}drawLine(t){var e=t[0],a=e[0]*c+y;10==e[0]&&(a+=d);var i=e[1]*c+g;10==e[1]&&(i+=d),v.moveTo(a,i);for(var r=1;r<t.length;r++){a=t[r][0]*c+y;10==t[r][0]&&(a+=d);i=t[r][1]*c+g;10==t[r][1]&&(i+=d),v.lineTo(a,i)}}drawLabyrinth(){this.drawLine([[5,0],[5,1],[4,1],[4,3]]),this.drawLine([[0,1],[2,1],[2,2],[3,2],[3,1]]),this.drawLine([[7,1],[10,1]]),this.drawLine([[6,1],[6,3]]),this.drawLine([[5,2],[9,2],[9,6]]),this.drawLine([[1,2],[1,3],[5,3]]),this.drawLine([[8,3],[7,3],[7,8]]),this.drawLine([[3,3],[3,5]]),this.drawLine([[3,4],[5,4]]),this.drawLine([[0,4],[2,4],[2,5],[1,5]]),this.drawLine([[8,4],[6,4],[6,5],[4,5],[4,7]]),this.drawLine([[9,5],[8,5],[8,7],[10,7]]),this.drawLine([[1,6],[4,6]]),this.drawLine([[2,6],[2,9]]),this.drawLine([[0,7],[1,7]]),this.drawLine([[1,8],[1,10]]),this.drawLine([[3,7],[3,10]]),this.drawLine([[3,8],[5,8],[5,6]]),this.drawLine([[4,9],[6,9],[6,8],[8,8],[8,9],[9,9],[9,8]]),this.drawLine([[5,9],[5,10]]),this.drawLine([[7,9],[7,10]]),v.stroke()}drawBorder(){v.strokeStyle=\"black\",v.strokeRect(y,g,p,p)}setBackground(){v.fillStyle=\"white\",v.fillRect(0,0,s.width,s.height)}touchEventHandler(t){t.preventDefault()}clearAITarget(){var t=h.aiTarget%10,e=parseInt(h.aiTarget/10),a=(t+1)*d+t*l+y,i=(e+1)*d+e*l+g;A.clearRect(a,i,20,20)}clearPlayerTarget(){var t=h.playerTarget%10,e=parseInt(h.playerTarget/10),a=(t+1)*d+t*l+y,i=(e+1)*d+e*l+g;A.clearRect(a,i,20,20)}drawAITarget(){var t=h.aiTarget,e=t%10,a=parseInt(t/10),i=(e+1)*d+e*l+y,r=(a+1)*d+a*l+g;A.drawImage(b,i,r),o.drawImage(_,0,0)}drawPlayerTarget(){var t=h.playerTarget,e=t%10,a=parseInt(t/10),i=(e+1)*d+e*l+y,r=(a+1)*d+a*l+g;A.drawImage(O,i,r),o.drawImage(_,0,0)}drawTarget(){h.aiLastTarget!=h.aiTarget&&this.clearAITarget(),this.drawAITarget(),h.playerLastTarget!=h.playerTarget&&this.clearPlayerTarget(),this.drawPlayerTarget()}drawAI(){var t=h.aiState,e=t%10,a=parseInt(t/10),i=(e+1)*d+e*l+y,r=(a+1)*d+a*l+g;0===h.aiAction?A.drawImage(E,i,r):1===h.aiAction?A.drawImage(R,i,r):2===h.aiAction?A.drawImage(B,i,r):A.drawImage(x,i,r),o.drawImage(_,0,0)}drawPlayer(){var t=-1;t=-1==h.playerAction?h.playerLastAction:h.playerAction;var e=h.playerState,a=e%10,i=parseInt(e/10),r=(a+1)*d+a*l+y,n=(i+1)*d+i*l+g;0===t?A.drawImage(M,r,n):1===t?A.drawImage(k,r,n):2===t?A.drawImage(C,r,n):A.drawImage(D,r,n),o.drawImage(_,0,0)}drawPoint(){if(h.shouldDrawPoint()){I.clearRect(0,0,f.width,f.height);var t=h.getPointRate(),e=P+S*(t-.05),a=P+S*(t+.05),i=I.createLinearGradient(e,0,a,0);i.addColorStop(0,\"red\"),i.addColorStop(1,\"blue\"),I.fillStyle=i,I.fillRect(P,L,S,T),h.resetLastRate()}o.drawImage(f,0,0)}clearAll(){o.clearRect(0,0,s.width,s.height),A.clearRect(0,0,_.width,_.height)}doRender(){this.clearAll(),o.drawImage(w,0,0),this.drawAI(),this.drawPlayer(),this.drawTarget(),this.drawPoint()}render(){this.doRender(),h.gameOver&&(this.hasEventBind||(this.hasEventBind=!0,this.touchHandler=this.touchEventHandler.bind(this),s.addEventListener(\"touchstart\",this.touchHandler)))}update(){h.checkGameOver(),h.gameOver||(h.nextAIState(),h.nextPlayerState(),h.isAIOver()&&h.randomAITarget(),h.isPlayerOver()&&h.randomPlayerTarget())}loop(){h.frame+=1,h.isPrepared()&&(h.frame%u==0&&this.update(),h.frame%m==0&&this.render()),this.aniId=window.requestAnimationFrame(this.bindLoop,s)}}}]);","extractedComments":[]}